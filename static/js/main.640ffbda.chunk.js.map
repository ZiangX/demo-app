{"version":3,"sources":["api/getDataFromSpreadsheet.js","App.js","reportWebVitals.js","index.js"],"names":["getDataFromSpreadsheet","token","spreadsheetId","a","fetch","method","headers","Authorization","res","ok","json","values","shift","getGoogleApiAccessTokenByRefreshToken","access_token","console","log","App","state","stocks","activities","positions","selectedCategory","componentDidMount","forEach","symbol","qty","price","accountType","parseInt","balance","setState","stockPositions","Table","responsive","striped","bordered","hover","size","Object","keys","length","entries","map","key","value","displaySelectedCategory","split","slice","filter","activity","className","colspan","parseFloat","toFixed","date","substring","selectCategory","Form","Group","Control","as","onChange","e","target","name","info","this","React","Component","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.640ffbda.chunk.js","sourcesContent":["// Using context api to get global token\r\nconst getDataFromSpreadsheet = async (token, spreadsheetId) => {\r\n  const res = await fetch(\r\n    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/Sheet1!A1:E`,\r\n    {\r\n      method: \"GET\",\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n    }\r\n  );\r\n  if (res.ok) {\r\n    let { values } = await res.json();\r\n    // Remove the first element\r\n    values.shift();\r\n    return values;\r\n  }\r\n  return [];\r\n};\r\n\r\n// https://cors-anywhere.herokuapp.com/\r\nconst getGoogleApiAccessTokenByRefreshToken = async () => {\r\n  const res = await fetch(\r\n    \"https://oauth2.googleapis.com/token?client_id=735001424008-cseikg1urk24ihdcbcr2cir85gm3jgi5.apps.googleusercontent.com&client_secret=DFNvgdLNdPB06RDZLLKUgNy3&grant_type=refresh_token&refresh_token=1//0dXPC1b6oSTP9CgYIARAAGA0SNwF-L9IrSW6AUOFNhgxNubhNyIyif711644aqiDNPILwc836yCVDp-lrLnPRfSysk3hSo5Lzuls\",\r\n    { method: \"POST\" }\r\n  );\r\n  if (res.ok) {\r\n    let { access_token } = await res.json();\r\n    console.log(\"access_token\", access_token);\r\n    return access_token;\r\n  }\r\n  return null;\r\n};\r\n\r\nexport { getDataFromSpreadsheet, getGoogleApiAccessTokenByRefreshToken };\r\n","import React, { useState } from \"react\";\nimport \"./App.css\";\n// import { getToken, getAccountInfomation } from \"./api/GetAccountInfomation\";\nimport { getDataFromSpreadsheet, getGoogleApiAccessTokenByRefreshToken } from \"./api/getDataFromSpreadsheet\";\nimport Table from \"react-bootstrap/Table\";\nimport Form from \"react-bootstrap/Form\";\n\nclass App extends React.Component {\n  state = {\n    stocks: [],\n    activities: [],\n    positions: { \"Individual TFSA\": {}, \"Individual margin\": {} },\n    selectedCategory: \"\",\n  };\n\n  componentDidMount = async () => {\n    // If the api call is failed, getting a new access token by refresh token\n    var token = await getGoogleApiAccessTokenByRefreshToken();\n\n    // Call activities spreadsheet to get the data\n    const activitiesSpreadsheetId = \"1su0gzMy04WDCQZM7hZTPITwBNg5onGWnTo_NZWu_F3U\";\n    var activities = await getDataFromSpreadsheet(token, activitiesSpreadsheetId);\n\n    // [27737857, 52130491].map(accountNum => {\n    // \tlet stocks = await getAccountInfomation(accountNum, \"positions\");\n    // \tlet balance = await getAccountInfomation(accountNum, \"balances\");\n    // \tthis.setState({ stocks, balance });\n    // })\n\n    var positions = { \"Individual TFSA\": {}, \"Individual margin\": {} };\n    activities.forEach(([date, symbol, qty, price, accountType]) => {\n      if (symbol in positions[accountType]) {\n        positions[accountType][symbol][\"qty\"] += parseInt(qty);\n        // if(qty > 0) {\n        //   buyingQty =\n        // }\n      } else {\n        positions[accountType][symbol] = { qty: parseInt(qty), balance: 0 };\n      }\n      // It is a bit counter intuitive, buying stock is counted as negative in the calculation, while selling is counted as positive number\n      positions[accountType][symbol][\"balance\"] += -(parseInt(qty) * price);\n    });\n    console.log(positions);\n    console.log(activities);\n    this.setState({ activities, positions });\n    // TODO Add rowNumber fetch function\n  };\n\n  stockPositions = () => (\n    <Table responsive striped bordered hover size=\"lg\">\n      <thead>\n        <tr>\n          {/* <th>时间</th> */}\n          <th>名称</th>\n          <th>数量</th>\n          {/* <th>价格</th> */}\n          <th>账户</th>\n        </tr>\n      </thead>\n      <tbody>\n        {Object.keys(this.state.positions).length !== 0 &&\n          Object.entries(this.state.positions[\"Individual TFSA\"]).map(([key, value]) => {\n            if (value[\"qty\"] !== 0) {\n              return (\n                <tr>\n                  <td>{key}</td>\n                  <td>{value[\"qty\"]}</td>\n                  <td>1</td>\n                </tr>\n              );\n            }\n          })}\n        {Object.keys(this.state.positions).length !== 0 &&\n          Object.entries(this.state.positions[\"Individual margin\"]).map(([key, value]) => {\n            if (value[\"qty\"] !== 0) {\n              return (\n                <tr>\n                  <td>{key}</td>\n                  <td>{value[\"qty\"]}</td>\n                  <td>2</td>\n                </tr>\n              );\n            }\n          })}\n      </tbody>\n    </Table>\n  );\n\n  displaySelectedCategory = () => {\n    var [accountType, symbol] = this.state.selectedCategory.split(\"/\");\n    var activities = this.state.activities.slice();\n    var balance;\n    if (this.state.selectedCategory !== \"\" && this.state.selectedCategory !== \"all\") {\n      activities = this.state.activities.filter((activity) => activity[1] === symbol && activity[4] === accountType);\n      balance = this.state.positions[accountType][symbol];\n      console.log(balance);\n    }\n\n    return (\n      <Table responsive striped bordered hover size=\"lg\">\n        <thead>\n          <tr>\n            <th className=\"mr-3\">时间</th>\n            <th className=\"mr-3\">名称</th>\n            <th className=\"mr-3\">数量</th>\n            <th className=\"mr-3\">价格</th>\n            <th className=\"mr-3\">账户</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr>\n            <td>{balance && \"全部营收\"}</td>\n            <td colspan=\"4\">{balance && parseFloat(balance[\"balance\"]).toFixed(2)}</td>\n          </tr>\n          {activities.map(([date, symbol, qty, price, accountType]) => (\n            <tr>\n              <td>{date.substring(5, 10)}</td>\n              <td>{symbol}</td>\n              <td>{parseInt(qty)}</td>\n              <td>{parseFloat(price).toFixed(2)}</td>\n              <td>{accountType === \"Individual TFSA\" ? \"1\" : \"2\"}</td>\n            </tr>\n          ))}\n        </tbody>\n      </Table>\n    );\n  };\n\n  selectCategory = () => {\n    return (\n      <Form.Group>\n        <Form.Control as=\"select\" onChange={(e) => this.setState({ selectedCategory: e.target.value })}>\n          <option value=\"all\">全部记录</option>\n          {Object.entries(this.state.positions[\"Individual TFSA\"]).map(([name, info]) => (\n            <option value={`Individual TFSA/${name}`}>{`1 ${name}  ${parseFloat(info[\"balance\"]).toFixed(0)}`}</option>\n          ))}\n          {Object.entries(this.state.positions[\"Individual margin\"]).map(([name, info]) => (\n            <option value={`Individual margin/${name}`}>{`2 ${name}  ${parseFloat(info[\"balance\"]).toFixed(0)}`}</option>\n          ))}\n        </Form.Control>\n      </Form.Group>\n    );\n  };\n\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">{this.stockPositions()}</header>\n        <header className=\"App-header select\">{this.selectCategory()}</header>\n        <header className=\"App-header table--selectedCategory\">{this.displaySelectedCategory()}</header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}